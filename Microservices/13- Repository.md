میخوایم بدون اینکه ادبیات domain model  عوض بشه یا ترکیب بشه با زیر ساخت و ذخیره و بازیابی در ارتباط باشیم 

کلا repository یک واسطه ای هست که وقتی داریم با  repository کار میکنیم انگار داریم با یک collection عادی کار میکنیم و کاربر یا توسعه دهنده حس نمیکنه با دیتابیس کار داره و حس کار با Collection بهش میده
مسئولیت دومش اینه که مدل داده رو از مدل اپلیکیشن جدا میکنه. کار تبدیل domain model به Data model رو هم وظیفه repository هست. رفع مشکلات transaction  و همزمانی و اینا همه رو از لایه domain model میپوشونه. 
یک repository برای یک aggregate تعریف میشه اون هم برای Aggregate root
کلا یک facade ای هست که جزییات پیاده سازی زیر ساخت رو پنهان میکنه و انگار ما با یک in memory collection داریم کار میکنیم
فانکشن های repository باید با ادبیان دامنه بخونه مثلا اگر کاربر تایید شده رو میخوایم از دیتابیس بخونیم نمیگیم selectFromCustomerTable بلکه میگیم getActivatedCustomers 
چون ادبیان دامنه هست تو لایه دامنه باید interface آن نوشته بشه و تو لایه repository پیاده سازی آن تایین میشه
استفاده کننده repository بخش application service هست. 

برداشت اشتباه repository
1- با وجود ORM یک لایه اضافه هست. 
2- با اضافه کردن این لایه پیچیدگی زیاد میشه

آیا repository یک ضد الگو هست؟ 
اگر مثلا از EF به عنوان Core استفاده کنیم چند ایراد داره
اینکه دسترسی توسعه دهنده باز نباشه در هر جای نرم افزار یک نکته مثبت هست. و باعث میشه قواعد بهتر کنترل شود. 
نام گذاری بهتر و مطابق با دامنه انجام میشه ولی اگر استفاده نکنیم از نام گذاری خود EF باید استفاده کنیم و نگهداریش سخت میشه. 

دست آورد استفاده repository
نوشتن تست های راحت تر
سادگی در جایگزینی زیر ساخت
با ادبیات دامنه  میتونیم با زیرساخت صحبت کنیم 

آیا repository همه جا کاربرد دارند؟
 ما دو نوع اپلیکیشن داریم. پیچیده و ساده. اگر اپلیکیشن ساده باشه و فقط CRUD بزنه دیگه نیازی به repository نداریم و از الگو های دیگه که گفته خواهد شد استفاده میکنیم ولی اگر اپلیکیشن rich domain model هست باید از repository استفاده کنیم تا این الگو رو کامل رعایت کرده باشیم. 

یکی از کارهایی که ORMها خیلی خوب انجام میدن اینه که مدل دامنه رو به مدل داده تبدیل میکنن و بر عکس. 
ولی اگر ORM تو این ضعف داشته باشه باید دو نوع کلاس مختلف پیاده سازی کنیم. مثلا خیلی وقت ها نیاز داریم اطلاعات Auditing رو ثبت و نگهداری کنیم. این اطلاعاتی هست که ربطی به مدل دامنه هم نداره و نباید با مدل دامنه ترکیب بشه. پس ORM ها قرار نیست جای repository رو بگیره بلکه repository ها استفاده کننده از repository هستند. 

الگو Generic Repository
خیلی از برنامه نویسان پول میگیرن که کد بنویسن ولی خیلی دوست دارن کد ننوسند برای همین میریم سمت generic repository 
اگر از این استفاده کنیم دیگه ادبیات دامنه همچنین ادبیات SOLID رو از دست میدیم. 
باز این هم بسته به اپلیکیشن داره ممکنه rich domain داشته باشیم ولی همه موجودیت ها create رو داشته باشن در این شرایط یک کلاس Generic میسازم که Create  داشته باشه و توی repository ها ازش استفاده میکنیم
ولی کلا بهتره ازش استفاده نکنیم

پیاده سازی repository
ممکنه پروژه جدید باشه که اصلاحا بهش میگن Green field 
در این صورت ممکنه به طور پیش فرض Sql server و EF core بیام استفاده کنم چون کامل مطبق هست با rich domain بدون اینکه هیچ شی واسطی نیاز داشته باشیم
ولی ممکنه به جاش از NHibernate استفاده کنم که باز هم کامل منطبق بر این داستان هست. 
گاهی ممکنه اپلیکیشن وجود داشته باشه و اجباری برای استفاده از ORM یا دیتابیس خاص وجود داشته باشه که منطبق به مدل دامنه من نباشه. یا مثلا طراحی دیتابیسی باشه که به راحتی مپ نشه به مدل دامنه من. اینجا دیگه مجبوریم بریم سراغ یک سری واسطه
1- در کلاس دامنه getter و setter بذاریم برای رد و بدل کردن داده. این اشکال به وجود میاد که ممکنه داده به state اشتباه بره چون خارج از فرآیند behavior داریم داده ست میکنیم روش
2- از الگو memento استفاده کنیم 
3-  از روش event streaming استفاده کنیم. که جلسات event sourcing صحبت خواهیم کرد. 
اگر مجبور بشیم از یک